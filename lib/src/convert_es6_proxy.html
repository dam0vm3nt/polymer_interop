<!--
Copyright (c) 2015, the Dart project authors.  Please see the AUTHORS file
for details. All rights reserved. Use of this source code is governed by a
BSD-style license that can be found in the LICENSE file.
-->
<script>
  Polymer.PolymerInterop = Polymer.PolymerInterop || {};
  Polymer.PolymerInterop.ES6 = Polymer.PolymerInterop.ES6 || {};



  (function(ES6) {

    ES6.Unsupported = {};

    var isADartMethod = function() {
      throw new Error("This method should be overridden by dart implementation");
    };

    ES6._dartGetter = isADartMethod;
    ES6._dartSetter = isADartMethod;
    ES6._dartArrayGet = isADartMethod;
    ES6._dartArrayPut = isADartMethod;
    ES6._dartArraySplice = isADartMethod;
    ES6._dartArraySlice = isADartMethod;
    ES6._dartArrayLength = isADartMethod;
    ES6._dartArrayPush = isADartMethod;

    /**
     * Object ES6JsProxy support
     */

    var commonBehaviors = {
      '__dartClass__' : function(instance) { return instance; },
      '__isES6Proxy__' : function(instance) { return true; }
    };

    ES6.createES6JsProxy = function(instance) {
      return new Proxy({},{
        'get' : function(target,propertyName,proxy) {

          if (commonBehaviors.hasOwnProperty(propertyName)) {
            return commonBehaviors[propertyName](instance);
          }

          var res = ES6._dartGetter(instance,propertyName);
          if(res === ES6.Unsupported) {
            return target[propertyName];
          } else {
            return res;
          }
        },
        'set' : function(target,propertyName,value,proxy) {
          if (ES6._dartSetter(instance,propertyName,value) === ES6.Unsupported) {
            target[propertyName] = value;
          }
          return true;
        }
      });
    };

    /**
     * List ES6JsProxy support
     */

    var arrayCommonBehaviors = {
      '__dartClass__' : function(instance) { return instance; },
      '__isES6Proxy__' : function(instance) { return true; },
      'splice' : function (instance) {
        return function(index,howmany) {
          return ES6._dartArraySplice(instance,index,howmany,Array.prototype.slice.call(arguments,2));
        };
      },
      'slice' : function(instance) {
        return function(begin,end) {
          return ES6._dartArraySlice(instance,begin,end);
        };
      },
      'length' : function(instance) { return ES6._dartArrayLength(instance); },
      'push' : function(instance) {
        return function() {
          return ES6._dartArrayPush(instance,Array.prototype.slice.call(arguments));
        };
      }
    };

    ES6.createES6JsProxyForArray = function(instance) {
      return new Proxy([],{
        'get' : function(target,propertyName,proxy) {

          if (arrayCommonBehaviors.hasOwnProperty(propertyName)) {
            return arrayCommonBehaviors[propertyName](instance);
          }

          if (isNaN(propertyName)) {
            return target[propertyName];
          }

          return ES6._dartArrayGet(instance,+propertyName);
        },

        'set' : function(target,propertyName,value,proxy) {
          if (isNaN(propertyName)) {
            target[propertyName] = value;
          } else {
            ES6._dartArrayPut(instance,+propertyName,value);
          }
          return true;
        }
      });
    };

    ES6.createMethodInvoker = function(dartInvoker) {
      return function() {
        dartInvoker(Array.prototype.slice.call(arguments));
      };
    };

  })(Polymer.PolymerInterop.ES6);
</script>
